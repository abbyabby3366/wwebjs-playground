import{_ as ge}from"../chunks/C1FmrZbK.js";import{S as be,i as ye,s as Ce,n as Y,d as c,b as z,c as r,r as G,o as i,p as we,h as M,e as d,f as w,q as W,u as se,k as A,j as f,v as xe,w as ke,a as X,g as R,t as J,x as _e,y as te,z as Ee,m as me}from"../chunks/ZyFKe9iZ.js";import{e as ae}from"../chunks/D6YF6ztN.js";import"../chunks/IHki7fMi.js";function ie(o,e,s){const t=o.slice();return t[26]=e[s],t}function ce(o,e,s){const t=o.slice();return t[29]=e[s],t}function De(o){let e,s=ae(o[3]),t=[];for(let l=0;l<s.length;l+=1)t[l]=ue(ce(o,s,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=se()},l(l){for(let a=0;a<t.length;a+=1)t[a].l(l);e=se()},m(l,a){for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(l,a);z(l,e,a)},p(l,a){if(a[0]&1034){s=ae(l[3]);let n;for(n=0;n<s.length;n+=1){const u=ce(l,s,n);t[n]?t[n].p(u,a):(t[n]=ue(u),t[n].c(),t[n].m(e.parentNode,e))}for(;n<t.length;n+=1)t[n].d(1);t.length=s.length}},d(l){l&&c(e),me(t,l)}}}function Ie(o){let e,s,t="💬",l,a,n="No conversations yet",u,h,x="Start chatting with your customers",b,g,k="Start New Chat",D,V;return{c(){e=f("div"),s=f("div"),s.textContent=t,l=A(),a=f("h3"),a.textContent=n,u=A(),h=f("p"),h.textContent=x,b=A(),g=f("button"),g.textContent=k,this.h()},l(y){e=d(y,"DIV",{class:!0});var v=w(e);s=d(v,"DIV",{class:!0,"data-svelte-h":!0}),W(s)!=="svelte-27es5x"&&(s.textContent=t),l=M(v),a=d(v,"H3",{class:!0,"data-svelte-h":!0}),W(a)!=="svelte-14l1dx6"&&(a.textContent=n),u=M(v),h=d(v,"P",{class:!0,"data-svelte-h":!0}),W(h)!=="svelte-1yemxyp"&&(h.textContent=x),b=M(v),g=d(v,"BUTTON",{class:!0,"data-svelte-h":!0}),W(g)!=="svelte-1h3tv8x"&&(g.textContent=k),v.forEach(c),this.h()},h(){i(s,"class","text-4xl mb-3"),i(a,"class","text-lg font-medium mb-2"),i(h,"class","text-sm mb-4"),i(g,"class","px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"),i(e,"class","p-6 text-center text-gray-500")},m(y,v){z(y,e,v),r(e,s),r(e,l),r(e,a),r(e,u),r(e,h),r(e,b),r(e,g),D||(V=G(g,"click",o[14]),D=!0)},p:Y,d(y){y&&c(e),D=!1,V()}}}function Ve(o){let e,s=`<div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"></div>
          Loading contacts...`;return{c(){e=f("div"),e.innerHTML=s,this.h()},l(t){e=d(t,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-1agu7tn"&&(e.innerHTML=s),this.h()},h(){i(e,"class","p-4 text-center text-gray-500")},m(t,l){z(t,e,l)},p:Y,d(t){t&&c(e)}}}function ue(o){let e,s,t,l=o[29].avatar+"",a,n,u,h,x,b=o[29].name+"",g,k,D,V,y,v,_,L=ne(new Date)+"",S,j,H,U=o[29].lastMessage+"",P,B,q,K,O;function N(){return o[15](o[29])}return{c(){e=f("div"),s=f("div"),t=f("div"),a=J(l),n=A(),u=f("div"),h=f("div"),x=f("h3"),g=J(b),k=A(),D=f("div"),V=f("div"),v=A(),_=f("span"),S=J(L),j=A(),H=f("p"),P=J(U),B=A(),this.h()},l(m){e=d(m,"DIV",{class:!0});var p=w(e);s=d(p,"DIV",{class:!0});var E=w(s);t=d(E,"DIV",{class:!0});var I=w(t);a=R(I,l),I.forEach(c),n=M(E),u=d(E,"DIV",{class:!0});var T=w(u);h=d(T,"DIV",{class:!0});var C=w(h);x=d(C,"H3",{class:!0});var F=w(x);g=R(F,b),F.forEach(c),k=M(C),D=d(C,"DIV",{class:!0});var Q=w(D);V=d(Q,"DIV",{class:!0}),w(V).forEach(c),v=M(Q),_=d(Q,"SPAN",{class:!0});var Z=w(_);S=R(Z,L),Z.forEach(c),Q.forEach(c),C.forEach(c),j=M(T),H=d(T,"P",{class:!0});var $=w(H);P=R($,U),$.forEach(c),T.forEach(c),E.forEach(c),B=M(p),p.forEach(c),this.h()},h(){var m;i(t,"class","w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center text-sm font-medium text-gray-700"),i(x,"class","text-sm font-medium text-gray-900 truncate"),i(V,"class",y="w-2 h-2 rounded-full "+(o[29].status==="online"?"bg-green-500":o[29].status==="away"?"bg-yellow-500":"bg-gray-400")),i(_,"class","text-xs text-gray-500"),i(D,"class","flex items-center space-x-1"),i(h,"class","flex items-center justify-between"),i(H,"class","text-sm text-gray-600 truncate"),i(u,"class","flex-1 min-w-0"),i(s,"class","flex items-center space-x-3"),i(e,"class",q="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors "+(((m=o[1])==null?void 0:m.id)===o[29].id?"bg-blue-50 border-l-4 border-l-blue-500":""))},m(m,p){z(m,e,p),r(e,s),r(s,t),r(t,a),r(s,n),r(s,u),r(u,h),r(h,x),r(x,g),r(h,k),r(h,D),r(D,V),r(D,v),r(D,_),r(_,S),r(u,j),r(u,H),r(H,P),r(e,B),K||(O=G(e,"click",N),K=!0)},p(m,p){var E;o=m,p[0]&8&&l!==(l=o[29].avatar+"")&&X(a,l),p[0]&8&&b!==(b=o[29].name+"")&&X(g,b),p[0]&8&&y!==(y="w-2 h-2 rounded-full "+(o[29].status==="online"?"bg-green-500":o[29].status==="away"?"bg-yellow-500":"bg-gray-400"))&&i(V,"class",y),p[0]&8&&U!==(U=o[29].lastMessage+"")&&X(P,U),p[0]&10&&q!==(q="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors "+(((E=o[1])==null?void 0:E.id)===o[29].id?"bg-blue-50 border-l-4 border-l-blue-500":""))&&i(e,"class",q)},d(m){m&&c(e),K=!1,O()}}}function de(o){let e,s,t,l=o[1].avatar+"",a,n,u,h,x=o[1].name+"",b,g,k,D=o[1].phone+"",V,y,v,_,L,S,j,H=o[1].status+"",U;return{c(){e=f("div"),s=f("div"),t=f("div"),a=J(l),n=A(),u=f("div"),h=f("h3"),b=J(x),g=A(),k=f("p"),V=J(D),y=A(),v=f("div"),_=f("div"),S=A(),j=f("span"),U=J(H),this.h()},l(P){e=d(P,"DIV",{class:!0});var B=w(e);s=d(B,"DIV",{class:!0});var q=w(s);t=d(q,"DIV",{class:!0});var K=w(t);a=R(K,l),K.forEach(c),n=M(q),u=d(q,"DIV",{});var O=w(u);h=d(O,"H3",{class:!0});var N=w(h);b=R(N,x),N.forEach(c),g=M(O),k=d(O,"P",{class:!0});var m=w(k);V=R(m,D),m.forEach(c),O.forEach(c),y=M(q),v=d(q,"DIV",{class:!0});var p=w(v);_=d(p,"DIV",{class:!0}),w(_).forEach(c),S=M(p),j=d(p,"SPAN",{class:!0});var E=w(j);U=R(E,H),E.forEach(c),p.forEach(c),q.forEach(c),B.forEach(c),this.h()},h(){i(t,"class","w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center text-sm font-medium text-gray-700"),i(h,"class","text-lg font-semibold text-gray-900"),i(k,"class","text-sm text-gray-600"),i(_,"class",L="w-2 h-2 rounded-full "+(o[1].status==="online"?"bg-green-500":o[1].status==="away"?"bg-yellow-500":"bg-gray-400")),i(j,"class","text-sm text-gray-500 capitalize"),i(v,"class","ml-auto flex items-center space-x-2"),i(s,"class","flex items-center space-x-3"),i(e,"class","chat-header")},m(P,B){z(P,e,B),r(e,s),r(s,t),r(t,a),r(s,n),r(s,u),r(u,h),r(h,b),r(u,g),r(u,k),r(k,V),r(s,y),r(s,v),r(v,_),r(v,S),r(v,j),r(j,U)},p(P,B){B[0]&2&&l!==(l=P[1].avatar+"")&&X(a,l),B[0]&2&&x!==(x=P[1].name+"")&&X(b,x),B[0]&2&&D!==(D=P[1].phone+"")&&X(V,D),B[0]&2&&L!==(L="w-2 h-2 rounded-full "+(P[1].status==="online"?"bg-green-500":P[1].status==="away"?"bg-yellow-500":"bg-gray-400"))&&i(_,"class",L),B[0]&2&&H!==(H=P[1].status+"")&&X(U,H)},d(P){P&&c(e)}}}function Ne(o){let e,s='<div class="text-center text-gray-500"><div class="text-6xl mb-4">💬</div> <h3 class="text-lg font-medium mb-2">Select a contact to start chatting</h3> <p class="text-sm">Choose from the list on the left to begin a conversation</p></div>';return{c(){e=f("div"),e.innerHTML=s,this.h()},l(t){e=d(t,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-14iv8ay"&&(e.innerHTML=s),this.h()},h(){i(e,"class","flex items-center justify-center h-full")},m(t,l){z(t,e,l)},p:Y,d(t){t&&c(e)}}}function Te(o){let e,s=ae(o[2]),t=[];for(let l=0;l<s.length;l+=1)t[l]=he(ie(o,s,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=se()},l(l){for(let a=0;a<t.length;a+=1)t[a].l(l);e=se()},m(l,a){for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(l,a);z(l,e,a)},p(l,a){if(a[0]&4){s=ae(l[2]);let n;for(n=0;n<s.length;n+=1){const u=ie(l,s,n);t[n]?t[n].p(u,a):(t[n]=he(u),t[n].c(),t[n].m(e.parentNode,e))}for(;n<t.length;n+=1)t[n].d(1);t.length=s.length}},d(l){l&&c(e),me(t,l)}}}function fe(o){let e;function s(a,n){return a[26].status==="sending"?Me:a[26].status==="sent"?je:a[26].status==="failed"?Se:Pe}let t=s(o),l=t(o);return{c(){e=f("span"),l.c(),this.h()},l(a){e=d(a,"SPAN",{class:!0});var n=w(e);l.l(n),n.forEach(c),this.h()},h(){i(e,"class","text-xs ml-2")},m(a,n){z(a,e,n),l.m(e,null)},p(a,n){t===(t=s(a))&&l?l.p(a,n):(l.d(1),l=t(a),l&&(l.c(),l.m(e,null)))},d(a){a&&c(e),l.d()}}}function Pe(o){let e,s="✓";return{c(){e=f("span"),e.textContent=s,this.h()},l(t){e=d(t,"SPAN",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-rc1rqh"&&(e.textContent=s),this.h()},h(){i(e,"class","text-green-500")},m(t,l){z(t,e,l)},p:Y,d(t){t&&c(e)}}}function Se(o){let e,s,t;return{c(){e=f("span"),s=J("✗"),this.h()},l(l){e=d(l,"SPAN",{class:!0,title:!0});var a=w(e);s=R(a,"✗"),a.forEach(c),this.h()},h(){i(e,"class","text-red-500"),i(e,"title",t=o[26].error||"Failed to send")},m(l,a){z(l,e,a),r(e,s)},p(l,a){a[0]&4&&t!==(t=l[26].error||"Failed to send")&&i(e,"title",t)},d(l){l&&c(e)}}}function je(o){let e,s="✓";return{c(){e=f("span"),e.textContent=s,this.h()},l(t){e=d(t,"SPAN",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-rc1rqh"&&(e.textContent=s),this.h()},h(){i(e,"class","text-green-500")},m(t,l){z(t,e,l)},p:Y,d(t){t&&c(e)}}}function Me(o){let e,s="⏳";return{c(){e=f("span"),e.textContent=s,this.h()},l(t){e=d(t,"SPAN",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-1tojjh6"&&(e.textContent=s),this.h()},h(){i(e,"class","text-yellow-500")},m(t,l){z(t,e,l)},p:Y,d(t){t&&c(e)}}}function he(o){let e,s,t,l=o[26].content+"",a,n,u,h,x=ne(o[26].timestamp)+"",b,g,k,D,V,y=(o[26].direction==="sent"||o[26].type==="sent")&&fe(o);return{c(){e=f("div"),s=f("div"),t=f("p"),a=J(l),n=A(),u=f("div"),h=f("span"),b=J(x),g=A(),y&&y.c(),D=A(),this.h()},l(v){e=d(v,"DIV",{class:!0});var _=w(e);s=d(_,"DIV",{class:!0});var L=w(s);t=d(L,"P",{class:!0});var S=w(t);a=R(S,l),S.forEach(c),n=M(L),u=d(L,"DIV",{class:!0});var j=w(u);h=d(j,"SPAN",{class:!0});var H=w(h);b=R(H,x),H.forEach(c),g=M(j),y&&y.l(j),j.forEach(c),L.forEach(c),D=M(_),_.forEach(c),this.h()},h(){i(t,"class","text-sm"),i(h,"class","text-xs opacity-75"),i(u,"class","flex items-center justify-between mt-1"),i(s,"class",k="chat-message-"+(o[26].direction==="sent"||o[26].type==="sent"?"user":"agent")),i(e,"class",V="flex "+(o[26].direction==="sent"||o[26].type==="sent"?"justify-end":"justify-start"))},m(v,_){z(v,e,_),r(e,s),r(s,t),r(t,a),r(s,n),r(s,u),r(u,h),r(h,b),r(u,g),y&&y.m(u,null),r(e,D)},p(v,_){_[0]&4&&l!==(l=v[26].content+"")&&X(a,l),_[0]&4&&x!==(x=ne(v[26].timestamp)+"")&&X(b,x),v[26].direction==="sent"||v[26].type==="sent"?y?y.p(v,_):(y=fe(v),y.c(),y.m(u,null)):y&&(y.d(1),y=null),_[0]&4&&k!==(k="chat-message-"+(v[26].direction==="sent"||v[26].type==="sent"?"user":"agent"))&&i(s,"class",k),_[0]&4&&V!==(V="flex "+(v[26].direction==="sent"||v[26].type==="sent"?"justify-end":"justify-start"))&&i(e,"class",V)},d(v){v&&c(e),y&&y.d()}}}function pe(o){let e,s,t,l,a,n,u,h,x;return{c(){e=f("div"),s=f("div"),t=f("input"),l=A(),a=f("button"),n=J("Send"),this.h()},l(b){e=d(b,"DIV",{class:!0});var g=w(e);s=d(g,"DIV",{class:!0});var k=w(s);t=d(k,"INPUT",{placeholder:!0,class:!0}),l=M(k),a=d(k,"BUTTON",{class:!0});var D=w(a);n=R(D,"Send"),D.forEach(c),k.forEach(c),g.forEach(c),this.h()},h(){i(t,"placeholder","Type your message..."),i(t,"class","flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"),a.disabled=u=!o[0].trim(),i(a,"class","px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"),i(s,"class","flex space-x-3"),i(e,"class","chat-input")},m(b,g){z(b,e,g),r(e,s),r(s,t),te(t,o[0]),r(s,l),r(s,a),r(a,n),h||(x=[G(t,"input",o[17]),G(t,"keypress",o[12]),G(a,"click",o[11])],h=!0)},p(b,g){g[0]&1&&t.value!==b[0]&&te(t,b[0]),g[0]&1&&u!==(u=!b[0].trim())&&(a.disabled=u)},d(b){b&&c(e),h=!1,_e(x)}}}function ve(o){let e,s,t,l="Start New Chat",a,n,u,h,x="Contact Name (Optional)",b,g,k,D,V,y="Phone Number *",v,_,L,S,j,H="Cancel",U,P,B,q,K,O;return{c(){e=f("div"),s=f("div"),t=f("h3"),t.textContent=l,a=A(),n=f("div"),u=f("div"),h=f("label"),h.textContent=x,b=A(),g=f("input"),k=A(),D=f("div"),V=f("label"),V.textContent=y,v=A(),_=f("input"),L=A(),S=f("div"),j=f("button"),j.textContent=H,U=A(),P=f("button"),B=J("Start Chat"),this.h()},l(N){e=d(N,"DIV",{class:!0});var m=w(e);s=d(m,"DIV",{class:!0});var p=w(s);t=d(p,"H3",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-wir8l"&&(t.textContent=l),a=M(p),n=d(p,"DIV",{class:!0});var E=w(n);u=d(E,"DIV",{});var I=w(u);h=d(I,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),W(h)!=="svelte-1j6yl2s"&&(h.textContent=x),b=M(I),g=d(I,"INPUT",{id:!0,placeholder:!0,class:!0}),I.forEach(c),k=M(E),D=d(E,"DIV",{});var T=w(D);V=d(T,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),W(V)!=="svelte-1tovctk"&&(V.textContent=y),v=M(T),_=d(T,"INPUT",{id:!0,placeholder:!0,class:!0}),T.forEach(c),E.forEach(c),L=M(p),S=d(p,"DIV",{class:!0});var C=w(S);j=d(C,"BUTTON",{class:!0,"data-svelte-h":!0}),W(j)!=="svelte-13iteys"&&(j.textContent=H),U=M(C),P=d(C,"BUTTON",{class:!0});var F=w(P);B=R(F,"Start Chat"),F.forEach(c),C.forEach(c),p.forEach(c),m.forEach(c),this.h()},h(){i(t,"class","text-lg font-semibold mb-4"),i(h,"for","newChatName"),i(h,"class","block text-sm font-medium text-gray-700 mb-1"),i(g,"id","newChatName"),i(g,"placeholder","Enter contact name"),i(g,"class","w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"),i(V,"for","newChatPhone"),i(V,"class","block text-sm font-medium text-gray-700 mb-1"),i(_,"id","newChatPhone"),i(_,"placeholder","+1234567890"),i(_,"class","w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"),_.required=!0,i(n,"class","space-y-4"),i(j,"class","px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"),i(P,"class","px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"),P.disabled=q=!o[6].trim(),i(S,"class","flex justify-end space-x-3 mt-6"),i(s,"class","bg-white rounded-lg p-6 max-w-md w-full mx-4"),i(e,"class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50")},m(N,m){z(N,e,m),r(e,s),r(s,t),r(s,a),r(s,n),r(n,u),r(u,h),r(u,b),r(u,g),te(g,o[7]),r(n,k),r(n,D),r(D,V),r(D,v),r(D,_),te(_,o[6]),r(s,L),r(s,S),r(S,j),r(S,U),r(S,P),r(P,B),K||(O=[G(g,"input",o[18]),G(_,"input",o[19]),G(j,"click",o[20]),G(P,"click",o[9])],K=!0)},p(N,m){m[0]&128&&g.value!==N[7]&&te(g,N[7]),m[0]&64&&_.value!==N[6]&&te(_,N[6]),m[0]&64&&q!==(q=!N[6].trim())&&(P.disabled=q)},d(N){N&&c(e),K=!1,_e(O)}}}function Ae(o){let e,s,t,l,a,n,u="Contacts",h,x,b='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>',g,k,D="Manage customer conversations",V,y,v,_,L,S,j,H,U,P,B;function q(C,F){return C[8]?Ve:C[3].length===0?Ie:De}let K=q(o),O=K(o),N=o[1]&&de(o);function m(C,F){return C[1]?Te:Ne}let p=m(o),E=p(o),I=o[1]&&pe(o),T=o[5]&&ve(o);return{c(){e=A(),s=f("div"),t=f("div"),l=f("div"),a=f("div"),n=f("h2"),n.textContent=u,h=A(),x=f("button"),x.innerHTML=b,g=A(),k=f("p"),k.textContent=D,V=A(),y=f("div"),O.c(),v=A(),_=f("div"),N&&N.c(),L=A(),S=f("div"),E.c(),j=A(),I&&I.c(),H=A(),T&&T.c(),U=se(),this.h()},l(C){we("svelte-1psjp5c",document.head).forEach(c),e=M(C),s=d(C,"DIV",{class:!0});var Q=w(s);t=d(Q,"DIV",{class:!0});var Z=w(t);l=d(Z,"DIV",{class:!0});var $=w(l);a=d($,"DIV",{class:!0});var le=w(a);n=d(le,"H2",{class:!0,"data-svelte-h":!0}),W(n)!=="svelte-a2b3vl"&&(n.textContent=u),h=M(le),x=d(le,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),W(x)!=="svelte-1kpkppf"&&(x.innerHTML=b),le.forEach(c),g=M($),k=d($,"P",{class:!0,"data-svelte-h":!0}),W(k)!=="svelte-1opxl64"&&(k.textContent=D),$.forEach(c),V=M(Z),y=d(Z,"DIV",{class:!0});var re=w(y);O.l(re),re.forEach(c),Z.forEach(c),v=M(Q),_=d(Q,"DIV",{class:!0});var ee=w(_);N&&N.l(ee),L=M(ee),S=d(ee,"DIV",{class:!0});var oe=w(S);E.l(oe),oe.forEach(c),j=M(ee),I&&I.l(ee),ee.forEach(c),Q.forEach(c),H=M(C),T&&T.l(C),U=se(),this.h()},h(){document.title="Chat - WhatsApp Chat Portal",i(n,"class","text-lg font-semibold text-gray-900"),i(x,"class","p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"),i(x,"title","Start new chat"),i(a,"class","flex items-center justify-between mb-2"),i(k,"class","text-sm text-gray-600"),i(l,"class","p-4 border-b border-gray-200"),i(y,"class","overflow-y-auto flex-1"),i(t,"class","chat-sidebar"),i(S,"class","chat-messages"),i(_,"class","flex-1 flex flex-col"),i(s,"class","chat-container h-full flex")},m(C,F){z(C,e,F),z(C,s,F),r(s,t),r(t,l),r(l,a),r(a,n),r(a,h),r(a,x),r(l,g),r(l,k),r(t,V),r(t,y),O.m(y,null),r(s,v),r(s,_),N&&N.m(_,null),r(_,L),r(_,S),E.m(S,null),o[16](S),r(_,j),I&&I.m(_,null),z(C,H,F),T&&T.m(C,F),z(C,U,F),P||(B=G(x,"click",o[13]),P=!0)},p(C,F){K===(K=q(C))&&O?O.p(C,F):(O.d(1),O=K(C),O&&(O.c(),O.m(y,null))),C[1]?N?N.p(C,F):(N=de(C),N.c(),N.m(_,L)):N&&(N.d(1),N=null),p===(p=m(C))&&E?E.p(C,F):(E.d(1),E=p(C),E&&(E.c(),E.m(S,null))),C[1]?I?I.p(C,F):(I=pe(C),I.c(),I.m(_,null)):I&&(I.d(1),I=null),C[5]?T?T.p(C,F):(T=ve(C),T.c(),T.m(U.parentNode,U)):T&&(T.d(1),T=null)},i:Y,o:Y,d(C){C&&(c(e),c(s),c(H),c(U)),O.d(),N&&N.d(),E.d(),o[16](null),I&&I.d(),T&&T.d(C),P=!1,B()}}}function ne(o){return o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function He(o,e,s){let t,l="",a=null,n=[],u=[],h,x=!1,b="",g="",k=!1;xe(async()=>{await V();try{const{io:m}=await ge(async()=>{const{io:p}=await import("../chunks/wSuXe0Ee.js");return{io:p}},[],import.meta.url);t=m(),t.on("connect",()=>{console.log("Connected to server")}),t.on("whatsapp_status",p=>{console.log("WhatsApp status:",p)}),t.on("message_received",p=>{const E={id:p.id||Date.now().toString(),direction:"received",type:"text",content:p.body||p.message||p.content,from:p.from,to:p.to,timestamp:new Date(p.timestamp||Date.now()),status:"delivered"};L(E),a&&p.from===a.phone&&s(3,u=u.map(I=>I.phone===p.from?{...I,lastMessage:E.content}:I))})}catch{console.log("Socket.IO not available, running in demo mode")}u.length>0&&v(u[0])});async function D(){if(!b.trim())return;const m={id:Date.now(),name:g.trim()||b,phone:b.trim(),avatar:(g.trim()||b).substring(0,2).toUpperCase(),status:"offline",lastMessage:"Start a new conversation",messageCount:0};s(3,u=[m,...u]),v(m),s(6,b=""),s(7,g=""),s(5,x=!1)}async function V(){s(8,k=!0);try{const p=await(await fetch("/api/contacts")).json();p.contacts&&p.contacts.length>0?s(3,u=p.contacts):s(3,u=[])}catch(m){console.error("Error loading contacts:",m),s(3,u=[])}finally{s(8,k=!1)}}async function y(m){try{const E=await(await fetch(`/api/messages?contact=${encodeURIComponent(m)}&limit=50`)).json();E.messages?s(2,n=E.messages.reverse()):(console.error("Failed to load messages:",E.error),s(2,n=[]))}catch(p){console.error("Error loading messages:",p),s(2,n=[])}}ke(()=>{t&&t.disconnect()});async function v(m){s(1,a=m),await y(m.phone),S()}async function _(){if(!l.trim()||!a)return;const m=l;s(0,l="");const p={id:Date.now().toString(),direction:"sent",type:"text",content:m,from:"agent",to:a.phone,timestamp:new Date,fromMe:!0,status:"sending"};L(p);try{const I=await(await fetch("/api/whatsapp/send-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipient:a.phone,message:m,messageType:"text"})})).json();I.success?(console.log("Message sent successfully through SvelteKit:",I),s(2,n=n.map(T=>T.id===p.id?{...T,status:"sent"}:T)),await Promise.all([y(a.phone),V()]),console.log("Data refreshed after sending message")):(console.error("Failed to send message to WhatsApp:",I.error),s(2,n=n.map(T=>T.id===p.id?{...T,status:"failed",error:I.error}:T)),alert(`Failed to send message: ${I.error}`))}catch(E){console.error("Error sending message:",E),s(2,n=n.map(I=>I.id===p.id?{...I,status:"failed",error:E.message}:I)),alert(`Error sending message: ${E.message}`)}}function L(m){s(2,n=[...n,m]),S()}function S(){setTimeout(()=>{h&&s(4,h.scrollTop=h.scrollHeight,h)},100)}function j(m){m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),_())}const H=()=>s(5,x=!0),U=()=>s(5,x=!0),P=m=>v(m);function B(m){Ee[m?"unshift":"push"](()=>{h=m,s(4,h)})}function q(){l=this.value,s(0,l)}function K(){g=this.value,s(7,g)}function O(){b=this.value,s(6,b)}return[l,a,n,u,h,x,b,g,k,D,v,_,j,H,U,P,B,q,K,O,()=>s(5,x=!1)]}class qe extends be{constructor(e){super(),ye(this,e,He,Ae,Ce,{},null,[-1,-1])}}export{qe as component};
