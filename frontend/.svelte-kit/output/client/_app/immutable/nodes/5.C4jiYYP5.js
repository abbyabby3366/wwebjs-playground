import"../chunks/CWj6FrbW.js";import{i as ne}from"../chunks/DbVienwh.js";import{p as le,o as ce,f as T,h as pe,j as w,e,c as s,g as r,l as rt,a as S,b as ve,$ as ue,m as b,k as i,s as l,x as Rt,r as t,i as k}from"../chunks/CPPbwToL.js";import{i as xe}from"../chunks/BBMtWJJw.js";import{e as ge,i as be}from"../chunks/HMgc3kw4.js";import{b as Nt,r as Pt}from"../chunks/DF61nx8T.js";import{s as At}from"../chunks/mMo-1mwx.js";import{b as Lt}from"../chunks/DI_cyar4.js";var me=T('<div class="text-center py-8 text-gray-500">No messages found. Try adjusting your search criteria.</div>'),fe=T('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><span class="flex items-center space-x-2"><span> </span> <span class="capitalize"> </span></span></td><td class="px-6 py-4 whitespace-nowrap"><span class="capitalize"> </span></td><td class="px-6 py-4 whitespace-nowrap"><span> </span></td><td class="px-6 py-4 max-w-xs truncate"> </td><td class="px-6 py-4 whitespace-nowrap"> </td><td class="px-6 py-4 whitespace-nowrap"><span class="text-sm text-gray-900 font-mono"> </span></td><td class="px-6 py-4 whitespace-nowrap"> </td><td class="px-6 py-4 whitespace-nowrap"> </td><td class="px-6 py-4 whitespace-nowrap"><span> </span></td></tr>'),_e=T('<div class="overflow-x-auto"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Direction</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Message Type</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Content</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">From</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sender Phone</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">To</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Timestamp</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div>'),ye=T('<div class="container mx-auto p-6 max-w-6xl"><div class="mb-6"><h1 class="text-3xl font-bold text-gray-900">Message Database</h1> <p class="text-gray-600">Search and analyze your message history</p></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6"><h3 class="text-lg font-semibold mb-4">Search Messages</h3> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Direction</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All</option><option>Sent</option><option>Received</option></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Type</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option>All</option><option>Text</option><option>Image</option><option>Video</option><option>Audio</option><option>Document</option></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Search Text</label> <input placeholder="Search in content..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Limit</label> <input type="number" min="1" max="1000" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div></div> <div class="flex justify-between items-center mt-4"><button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"> </button> <div class="flex space-x-2"><button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Clear Filters</button> <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Export Results</button></div></div></div> <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"><div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="text-center"><div class="text-2xl font-bold text-blue-600"> </div> <div class="text-sm text-gray-600">Total Messages</div></div></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="text-center"><div class="text-2xl font-bold text-green-600"> </div> <div class="text-sm text-gray-600">Received</div></div></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="text-center"><div class="text-2xl font-bold text-purple-600"> </div> <div class="text-sm text-gray-600">Sent</div></div></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="text-center"><div class="text-2xl font-bold text-orange-600"> </div> <div class="text-sm text-gray-600">Unique Contacts</div></div></div></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold">Search Results</h3> <span class="text-sm text-gray-600"> </span></div> <!></div></div>');function Re($t,Ct){le(Ct,!1);let n=b([]),m=b(""),v=b(""),u=b(""),f=b(50),y=b(!1);ce(()=>{D()});async function D(){l(y,!0);try{const a=new URLSearchParams;r(v)&&a.append("direction",r(v)),r(u)&&a.append("type",r(u)),r(m)&&a.append("search",r(m)),r(f)&&a.append("limit",r(f).toString());const c=await(await fetch(`/api/mongodb/messages/search?${a.toString()}`)).json();c.success&&c.messages?l(n,c.messages.map(o=>{var d,x,g;const h=((d=o.metadata)==null?void 0:d.isGroup)||o.to&&o.to.includes("@g.us")||o.from&&o.from.includes("@g.us");return{id:((x=o._id)==null?void 0:x.toString())||o.id||Date.now().toString(),direction:o.direction||(o.fromMe?"sent":"received"),type:o.type||"text",content:o.body||o.content||"",from:o.from||"",to:o.to||"",timestamp:new Date(o.timestamp||o.createdAt),status:o.status||"delivered",contact:o.fromMe?o.to:o.from,realPhoneNumber:((g=o.metadata)==null?void 0:g.realPhoneNumber)||o.from,isGroup:h,messageType:h?"Group":"Individual"}})):(l(n,[]),console.error("Failed to load messages:",c.error))}catch(a){console.error("Error searching messages:",a),l(n,[])}finally{l(y,!1)}}function Gt(){if(r(n).length===0){alert("No messages to export. Please search for messages first.");return}const a=JSON.stringify(r(n),null,2),p=new Blob([a],{type:"application/json"}),c=URL.createObjectURL(p),o=document.createElement("a");o.href=c,o.download="messages-export.json",o.click()}function zt(a){return a.toLocaleString()}function Ut(a){switch(a){case"delivered":return"bg-green-100 text-green-800";case"sent":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function Et(a){return a==="sent"?"ðŸ“¤":"ðŸ“¥"}ne();var M=ye();pe(a=>{ue.title="Database - WhatsApp Chat Portal"});var j=s(e(M),2),R=s(e(j),2),N=e(R),P=s(e(N),2);w(()=>{r(v),Rt(()=>{})});var A=e(P);A.value=A.__value="";var L=s(A);L.value=L.__value="sent";var st=s(L);st.value=st.__value="received",t(P),t(N);var $=s(N,2),C=s(e($),2);w(()=>{r(u),Rt(()=>{})});var G=e(C);G.value=G.__value="";var z=s(G);z.value=z.__value="text";var U=s(z);U.value=U.__value="image";var E=s(U);E.value=E.__value="video";var F=s(E);F.value=F.__value="audio";var ot=s(F);ot.value=ot.__value="document",t(C),t($);var I=s($,2),it=s(e(I),2);Pt(it),t(I);var dt=s(I,2),nt=s(e(dt),2);Pt(nt),t(dt),t(R);var lt=s(R,2),_=e(lt),Ft=e(_,!0);t(_);var ct=s(_,2),pt=e(ct),vt=s(pt,2);t(ct),t(lt),t(j);var B=s(j,2),O=e(B),ut=e(O),xt=e(ut),It=e(xt,!0);t(xt),k(2),t(ut),t(O);var q=s(O,2),gt=e(q),bt=e(gt),Bt=e(bt,!0);t(bt),k(2),t(gt),t(q);var J=s(q,2),mt=e(J),ft=e(mt),Ot=e(ft,!0);t(ft),k(2),t(mt),t(J);var _t=s(J,2),yt=e(_t),ht=e(yt),qt=e(ht,!0);t(ht),k(2),t(yt),t(_t),t(B);var wt=s(B,2),Q=e(wt),St=s(e(Q),2),Jt=e(St);t(St),t(Q);var Qt=s(Q,2);{var Vt=a=>{var p=me();S(a,p)},Wt=a=>{var p=_e(),c=e(p),o=s(e(c));ge(o,5,()=>r(n),be,(h,d)=>{var x=fe(),g=e(x),kt=e(g),V=e(kt),Ht=e(V,!0);t(V);var Tt=s(V,2),Kt=e(Tt,!0);t(Tt),t(kt),t(g);var W=s(g),Dt=e(W),Xt=e(Dt,!0);t(Dt),t(W);var H=s(W),K=e(H),Yt=e(K,!0);t(K),t(H);var X=s(H),Zt=e(X,!0);t(X);var Y=s(X),te=e(Y,!0);t(Y);var Z=s(Y),Mt=e(Z),ee=e(Mt,!0);t(Mt),t(Z);var tt=s(Z),ae=e(tt,!0);t(tt);var et=s(tt),re=e(et,!0);t(et);var jt=s(et),at=e(jt),se=e(at,!0);t(at),t(jt),t(x),w((oe,ie,de)=>{i(Ht,oe),i(Kt,r(d).direction),i(Xt,r(d).type),At(K,1,`px-2 py-1 text-xs rounded-full ${r(d).isGroup?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`),i(Yt,r(d).messageType),i(Zt,r(d).content),i(te,r(d).from),i(ee,r(d).realPhoneNumber||"N/A"),i(ae,r(d).to),i(re,ie),At(at,1,`px-2 py-1 text-xs rounded-full ${de??""}`),i(se,r(d).status)},[()=>Et(r(d).direction),()=>zt(r(d).timestamp),()=>Ut(r(d).status)]),S(h,x)}),t(o),t(c),t(p),S(a,p)};xe(Qt,a=>{r(n).length===0?a(Vt):a(Wt,!1)})}t(wt),t(M),w((a,p,c)=>{_.disabled=r(y),i(Ft,r(y)?"Searching...":"Search Messages"),vt.disabled=r(n).length===0,i(It,r(n).length),i(Bt,a),i(Ot,p),i(qt,c),i(Jt,`${r(n).length??""} messages found`)},[()=>r(n).filter(a=>a.direction==="received").length,()=>r(n).filter(a=>a.direction==="sent").length,()=>new Set(r(n).map(a=>a.from)).size]),Lt(P,()=>r(v),a=>l(v,a)),Lt(C,()=>r(u),a=>l(u,a)),Nt(it,()=>r(m),a=>l(m,a)),Nt(nt,()=>r(f),a=>l(f,a)),rt("click",_,D),rt("click",pt,()=>{l(v,""),l(u,""),l(m,""),l(f,50),D()}),rt("click",vt,Gt),S($t,M),ve()}export{Re as component};
